// LiveValidation 1.4 (lusever version)
// Copyright (c) 2007-2010 Alec Hill (www.livevalidation.com)
// LiveValidation is licensed under the terms of the MIT License
var LiveValidation=function(a,b){this.initialize(a,b)};LiveValidation.VERSION="1.4 standalone",LiveValidation.TEXTAREA=1,LiveValidation.TEXT=2,LiveValidation.PASSWORD=3,LiveValidation.CHECKBOX=4,LiveValidation.SELECT=5,LiveValidation.FILE=6,LiveValidation.massValidate=function(a){var b=!0;for(var c=0,d=a.length;c<d;++c){var e=a[c].validate();b&&(b=e)}return b},LiveValidation.prototype={validClass:"LV_valid",invalidClass:"LV_invalid",messageClass:"LV_validation_message",validFieldClass:"LV_valid_field",invalidFieldClass:"LV_invalid_field",initialize:function(a,b){var c=this;if(!a)throw new Error("LiveValidation::initialize - No element reference or element id has been provided!");this.element=a.nodeName?a:document.getElementById(a);if(!this.element)throw new Error("LiveValidation::initialize - No element with reference or id of '"+a+"' exists!");this.validations=[],this.elementType=this.getElementType(),this.form=this.element.form;var d=b||{};this.validMessage=d.validMessage===undefined?"Thankyou!":d.validMessage;var e=d.insertAfterWhatNode||this.element;this.insertAfterWhatNode=e.nodeType?e:document.getElementById(e),this.onlyOnBlur=d.onlyOnBlur||!1,this.wait=d.wait||0,this.onlyOnSubmit=d.onlyOnSubmit||!1,this.beforeValidation=d.beforeValidation||function(){},this.beforeValid=d.beforeValid||function(){},this.onValid=d.onValid||function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass()},this.afterValid=d.afterValid||function(){},this.beforeInvalid=d.beforeInvalid||function(){},this.onInvalid=d.onInvalid||function(){this.insertMessage(this.createMessageSpan()),this.addFieldClass()},this.afterInvalid=d.afterInvalid||function(){},this.afterValidation=d.afterValidation||function(){},this.form&&(this.formObj=LiveValidationForm.getInstance(this.form),this.formObj.addField(this)),this.oldOnFocus=this.element.onfocus||function(){},this.oldOnBlur=this.element.onblur||function(){},this.oldOnClick=this.element.onclick||function(){},this.oldOnChange=this.element.onchange||function(){},this.oldOnKeyup=this.element.onkeyup||function(){},this.element.onfocus=function(a){return c.doOnFocus(a),c.oldOnFocus.call(this,a)};switch(this.elementType){case LiveValidation.CHECKBOX:this.element.onclick=function(a){return c.validate(a),c.oldOnClick.call(this,a)};case LiveValidation.SELECT:case LiveValidation.FILE:this.element.onchange=function(a){return c.validate(a),c.oldOnChange.call(this,a)};break;default:this.element.onkeyup=function(a){return c.deferValidation(a),c.oldOnKeyup.call(this,a)},this.element.onblur=function(a){return c.doOnBlur(a),c.oldOnBlur.call(this,a)}}},destroy:function(){this.formObj&&(this.formObj.removeField(this),this.formObj.destroy()),this.element.onfocus=this.oldOnFocus;switch(this.elementType){case LiveValidation.CHECKBOX:this.element.onclick=this.oldOnClick;case LiveValidation.SELECT:case LiveValidation.FILE:this.element.onchange=this.oldOnChange;break;default:this.element.onkeyup=this.oldOnKeyup,this.element.onblur=this.oldOnBlur}this.validations=[],this.removeMessageAndFieldClass()},add:function(a,b){return this.validations.push({type:a,onlyOnBlur:b&&b.onlyOnBlur!==undefined?b.onlyOnBlur:this.onlyOnBlur,onlyOnSubmit:b&&b.onlyOnSubmit!==undefined?b.onlyOnSubmit:this.onlyOnSubmit,params:b||{}}),this},remove:function(a,b){var c=[];for(var d=0,e=this.validations.length;d<e;d++){var f=this.validations[d];f.type!=a&&f.params!=b&&c.push(f)}return this.validations=c,this},deferValidation:function(a){this.wait>=300&&this.removeMessageAndFieldClass();var b=this;this.timeout&&clearTimeout(b.timeout),this.timeout=setTimeout(function(){b.validate(a)},b.wait)},doOnBlur:function(a){this.focused=!1,this.validate(a)},doOnFocus:function(a){this.focused=!0,this.removeMessageAndFieldClass()},getElementType:function(){var a=this.element.nodeName.toUpperCase(),b=this.element.type.toUpperCase();switch(!0){case a=="TEXTAREA":return LiveValidation.TEXTAREA;case a=="INPUT"&&b=="TEXT":return LiveValidation.TEXT;case a=="INPUT"&&b=="PASSWORD":return LiveValidation.PASSWORD;case a=="INPUT"&&b=="CHECKBOX":return LiveValidation.CHECKBOX;case a=="INPUT"&&b=="FILE":return LiveValidation.FILE;case a=="SELECT":return LiveValidation.SELECT;case a=="INPUT":throw new Error("LiveValidation::getElementType - Cannot use LiveValidation on an "+b.toLowerCase()+" input!");default:throw new Error("LiveValidation::getElementType - Element must be an input, select, or textarea - "+a.toLowerCase()+" was given!")}},doValidations:function(a){this.validationFailed=!1;for(var b=0,c=a.length;b<c;++b){this.validationFailed=!this.validateElement(a[b].type,a[b].params);if(this.validationFailed)return!1}return this.message=this.validMessage,!0},validateElement:function(a,b){switch(a){case Validate.Presence:case Validate.Confirmation:case Validate.Acceptance:this.displayMessageWhenEmpty=!0;break;case Validate.Custom:b.displayMessageWhenEmpty&&(this.displayMessageWhenEmpty=!0)}var c=this.elementType==LiveValidation.SELECT?this.element.options[this.element.selectedIndex].value:this.element.value;if(a==Validate.Acceptance){if(this.elementType!=LiveValidation.CHECKBOX)throw new Error("LiveValidation::validateElement - Element to validate acceptance must be a checkbox!");c=this.element.checked}var d=!0;try{a(c,b)}catch(e){if(!(e instanceof Validate.Error))throw e;if(c!==""||c===""&&this.displayMessageWhenEmpty)this.validationFailed=!0,this.message=e.message.split("\n")[0],d=!1}finally{return d}},validate:function(a){if(!this.element.disabled){var b=[],c=-1,d;while(d=this.validations[++c])(!a||a.type==="blur"&&!d.onlyOnSubmit||!d.onlyOnBlur&&!d.onlyOnSubmit)&&b.push(d);if(!b.length)return!0;this.beforeValidation();var e=this.doValidations(b);return e?(this.beforeValid(),this.onValid(),this.afterValid(),!0):(this.beforeInvalid(),this.onInvalid(),this.afterInvalid(),!1)}return!0},enable:function(){return this.element.disabled=!1,this},disable:function(){return this.element.disabled=!0,this.removeMessageAndFieldClass(),this},createMessageSpan:function(){var a=document.createElement("span"),b=document.createTextNode(this.message);return a.appendChild(b),a},insertMessage:function(a){this.removeMessage();if(!this.validationFailed&&typeof this.validMessage!="string")return;if(this.displayMessageWhenEmpty&&(this.elementType==LiveValidation.CHECKBOX||this.element.value=="")||this.element.value!=""){var b=this.validationFailed?this.invalidClass:this.validClass;a.className+=" "+this.messageClass+" "+b;var c=this.insertAfterWhatNode.parentNode;this.insertAfterWhatNode.nextSibling?c.insertBefore(a,this.insertAfterWhatNode.nextSibling):c.appendChild(a)}},addFieldClass:function(){this.removeFieldClass(),this.validationFailed?this.element.className.indexOf(this.invalidFieldClass)==-1&&(this.element.className+=" "+this.invalidFieldClass):(this.displayMessageWhenEmpty||this.element.value!="")&&this.element.className.indexOf(this.validFieldClass)==-1&&(this.element.className+=" "+this.validFieldClass)},removeMessage:function(){var a,b=this.insertAfterWhatNode;while(b.nextSibling){if(b.nextSibling.nodeType===1){a=b.nextSibling;break}b=b.nextSibling}a&&a.className.indexOf(this.messageClass)!=-1&&this.insertAfterWhatNode.parentNode.removeChild(a)},removeFieldClass:function(){var a=this.element.className;a.indexOf(this.invalidFieldClass)!=-1&&(this.element.className=a.split(this.invalidFieldClass).join("")),a.indexOf(this.validFieldClass)!=-1&&(this.element.className=a.split(this.validFieldClass).join(" "))},removeMessageAndFieldClass:function(){this.removeMessage(),this.removeFieldClass()}};var LiveValidationForm=function(a){this.initialize(a)};LiveValidationForm.instances={},LiveValidationForm.getInstance=function(a){if(!a)throw new Error("LiveValidationForm::getInstance - No element reference or element id has been provided!");var b=a.nodeName?a:document.getElementById(a),c=Math.random()*Math.random();return b.id||(b.id="formId_"+c.toString().replace(/\./,"")+(new Date).valueOf()),LiveValidationForm.instances[b.id]||(LiveValidationForm.instances[b.id]=new LiveValidationForm(b)),LiveValidationForm.instances[b.id]},LiveValidationForm.prototype={beforeValidation:function(){},onValid:function(){},onInvalid:function(){},afterValidation:function(){},initialize:function(a){this.name=a.id,this.element=a,this.fields=[],this.oldOnSubmit=this.element.onsubmit||function(){};var b=this;this.element.onsubmit=function(a){var c=!1;b.beforeValidation(),b.valid=LiveValidation.massValidate(b.fields),b.valid?b.onValid():b.onInvalid(),b.afterValidation(),b.valid&&(c=b.oldOnSubmit.call(this,a||window.event)!==!1);if(!c)return c}},addField:function(a){this.fields.push(a)},removeField:function(a){var b=[];for(var c=0,d=this.fields.length;c<d;c++)this.fields[c]!==a&&b.push(this.fields[c]);this.fields=b},destroy:function(a){return this.fields.length!=0&&!a?!1:(this.element.onsubmit=this.oldOnSubmit,LiveValidationForm.instances[this.name]=null,!0)}};var Validate={Presence:function(a,b){var b=b||{},c=b.failureMessage||"Can't be empty!";return(a===""||a===null||a===undefined)&&Validate.fail(c),!0},Numericality:function(a,b){var c=a,a=Number(a),b=b||{},d=b.minimum||b.minimum==0?b.minimum:null,e=b.maximum||b.maximum==0?b.maximum:null,f=b.is||b.is==0?b.is:null,g=b.notANumberMessage||"Must be a number!",h=b.notAnIntegerMessage||"Must be an integer!",i=b.wrongNumberMessage||"Must be "+f+"!",j=b.tooLowMessage||"Must not be less than "+d+"!",k=b.tooHighMessage||"Must not be more than "+e+"!";isFinite(a)||Validate.fail(g),b.onlyInteger&&(/\.0+$|\.$/.test(String(c))||a!=parseInt(a))&&Validate.fail(h);switch(!0){case f!==null:a!=Number(f)&&Validate.fail(i);break;case d!==null&&e!==null:Validate.Numericality(a,{tooLowMessage:j,minimum:d}),Validate.Numericality(a,{tooHighMessage:k,maximum:e});break;case d!==null:a<Number(d)&&Validate.fail(j);break;case e!==null:a>Number(e)&&Validate.fail(k)}return!0},Format:function(a,b){var a=String(a),b=b||{},c=b.failureMessage||"Not valid!",d=b.pattern||/./,e=b.negate||!1;return!e&&!d.test(a)&&Validate.fail(c),e&&d.test(a)&&Validate.fail(c),!0},Email:function(a,b){var b=b||{},c=b.failureMessage||"Must be a valid email address!";return Validate.Format(a,{failureMessage:c,pattern:/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i}),!0},Length:function(a,b){var a=String(a),b=b||{},c=b.minimum||b.minimum==0?b.minimum:null,d=b.maximum||b.maximum==0?b.maximum:null,e=b.is||b.is==0?b.is:null,f=b.wrongLengthMessage||"Must be "+e+" characters long!",g=b.tooShortMessage||"Must not be less than "+c+" characters long!",h=b.tooLongMessage||"Must not be more than "+d+" characters long!";switch(!0){case e!==null:a.length!=Number(e)&&Validate.fail(f);break;case c!==null&&d!==null:Validate.Length(a,{tooShortMessage:g,minimum:c}),Validate.Length(a,{tooLongMessage:h,maximum:d});break;case c!==null:a.length<Number(c)&&Validate.fail(g);break;case d!==null:a.length>Number(d)&&Validate.fail(h);break;default:throw new Error("Validate::Length - Length(s) to validate against must be provided!")}return!0},Inclusion:function(a,b){var b=b||{},c=b.failureMessage||"Must be included in the list!",d=b.caseSensitive===!1?!1:!0;if(b.allowNull&&a==null)return!0;!b.allowNull&&a==null&&Validate.fail(c);var e=b.within||[];if(!d){var f=[];for(var g=0,h=e.length;g<h;++g){var i=e[g];typeof i=="string"&&(i=i.toLowerCase()),f.push(i)}e=f,typeof a=="string"&&(a=a.toLowerCase())}var j=!1;for(var k=0,h=e.length;k<h;++k)e[k]==a&&(j=!0),b.partialMatch&&a.indexOf(e[k])!=-1&&(j=!0);return(!b.negate&&!j||b.negate&&j)&&Validate.fail(c),!0},Exclusion:function(a,b){var b=b||{};return b.failureMessage=b.failureMessage||"Must not be included in the list!",b.negate=!0,Validate.Inclusion(a,b),!0},Confirmation:function(a,b){if(!b.match)throw new Error("Validate::Confirmation - Error validating confirmation: Id of element to match must be provided!");var b=b||{},c=b.failureMessage||"Does not match!",d=b.match.nodeName?b.match:document.getElementById(b.match);if(!d)throw new Error("Validate::Confirmation - There is no reference with name of, or element with id of '"+b.match+"'!");return a!=d.value&&Validate.fail(c),!0},Acceptance:function(a,b){var b=b||{},c=b.failureMessage||"Must be accepted!";return a||Validate.fail(c),!0},Custom:function(a,b){var b=b||{},c=b.against||function(){return!0},d=b.args||{},e=b.failureMessage||"Not valid!";return c(a,d)||Validate.fail(e),!0},now:function(a,b,c){if(!a)throw new Error("Validate::now - Validation function must be provided!");var d=!0;try{a(b,c||{})}catch(e){if(e instanceof Validate.Error)d=!1;else throw e}finally{return d}},fail:function(a){throw new Validate.Error(a)},Error:function(a){this.message=a,this.name="ValidationError"}}
(function(){function c(){this.returnValue=!1}function b(){this.cancelBubble=!0}var a=0,k=[],n={},u={},w={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},d=/[<>&\"\']/g,m=window.setTimeout,r={},p;(function(q){q=q.split(/,/);var a,b,g;for(a=0;a<q.length;a+=2)for(g=q[a+1].split(/ /),b=0;b<g.length;b++)u[g[b]]=q[a]})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");
var h={VERSION:"1.5.4",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:u,ua:function(){var q=navigator,a=q.userAgent,b=q.vendor,g,e;e=(g=/WebKit/.test(a))&&-1!==b.indexOf("Apple");b=window.opera&&window.opera.buildNumber;return{windows:-1!==navigator.platform.indexOf("Win"),
ie:!g&&!b&&/MSIE/gi.test(a)&&/Explorer/gi.test(q.appName),webkit:g,gecko:!g&&/Gecko/.test(a),safari:e,opera:!!b}}(),typeOf:function(q){return{}.toString.call(q).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(q){h.each(arguments,function(a,b){0<b&&h.each(a,function(a,e){q[e]=a})});return q},cleanName:function(a){var l,b;b=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,
"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(l=0;l<b.length;l+=2)a=a.replace(b[l],b[l+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(a,l){l.name=a;k[a]=l;k.push(l);return l},guid:function(){var q=(new Date).getTime().toString(32),l;for(l=0;5>l;l++)q+=Math.floor(65535*Math.random()).toString(32);return(h.guidPrefix||"p")+q+(a++).toString(32)},buildUrl:function(a,l){var b="";h.each(l,function(a,q){b+=(b?"&":"")+encodeURIComponent(q)+
"="+encodeURIComponent(a)});b&&(a+=(0<a.indexOf("?")?"&":"?")+b);return a},each:function(a,l){var b,g;if(a)if(b=a.length,void 0===b)for(g in a){if(a.hasOwnProperty(g)&&!1===l(a[g],g))break}else for(g=0;g<b&&!1!==l(a[g],g);g++);},formatSize:function(a){return void 0===a||/\D/.test(a)?h.translate("N/A"):1073741824<a?Math.round(a/1073741824,1)+" GB":1048576<a?Math.round(a/1048576,1)+" MB":1024<a?Math.round(a/1024,1)+" KB":a+" b"},getPos:function(a,l){function b(a){var q,f=0;q=0;a&&(q=a.getBoundingClientRect(),
a="CSS1Compat"===t.compatMode?t.documentElement:t.body,f=q.left+a.scrollLeft,q=q.top+a.scrollTop);return{x:f,y:q}}var g=0,e=0,f,t=document;l=l||t.body;if(a&&a.getBoundingClientRect&&0<navigator.userAgent.indexOf("MSIE")&&8>t.documentMode)return g=b(a),e=b(l),{x:g.x-e.x,y:g.y-e.y};for(f=a;f&&f!=l&&f.nodeType;)g+=f.offsetLeft||0,e+=f.offsetTop||0,f=f.offsetParent;for(f=a.parentNode;f&&f!=l&&f.nodeType;)g-=f.scrollLeft||0,e-=f.scrollTop||0,f=f.parentNode;return{x:g,y:e}},getSize:function(a){return{w:a.offsetWidth||
a.clientWidth,h:a.offsetHeight||a.clientHeight}},parseSize:function(a){var l;"string"==typeof a&&(a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),l=a[2],a=+a[1],"g"==l&&(a*=1073741824),"m"==l&&(a*=1048576),"k"==l&&(a*=1024));return a},xmlEncode:function(a){return a?(""+a).replace(d,function(a){return w[a]?"&"+w[a]+";":a}):a},toArray:function(a){var l,b=[];for(l=0;l<a.length;l++)b[l]=a[l];return b},inArray:function(a,l){if(l){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(l,
a);for(var b=0,g=l.length;b<g;b++)if(l[b]===a)return b}return-1},addI18n:function(a){return h.extend(n,a)},translate:function(a){return n[a]||a},isEmptyObj:function(a){if(void 0===a)return!0;for(var b in a)return!1;return!0},hasClass:function(a,b){return""==a.className?!1:(new RegExp("(^|\\s+)"+b+"(\\s+|$)")).test(a.className)},addClass:function(a,b){h.hasClass(a,b)||(a.className=""==a.className?b:a.className.replace(/\s+$/,"")+" "+b)},removeClass:function(a,b){a.className=a.className.replace(new RegExp("(^|\\s+)"+
b+"(\\s+|$)"),function(a,q,e){return" "===q&&" "===e?" ":""})},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},addEvent:function(a,l,d,g){var e;l=l.toLowerCase();void 0===p&&(p="Plupload_"+h.guid());a.addEventListener?(e=d,a.addEventListener(l,e,!1)):a.attachEvent&&(e=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=c;a.stopPropagation=b;d(a)},a.attachEvent("on"+l,e));void 0===a[p]&&
(a[p]=h.guid());r.hasOwnProperty(a[p])||(r[a[p]]={});a=r[a[p]];a.hasOwnProperty(l)||(a[l]=[]);a[l].push({func:e,orig:d,key:g})},removeEvent:function(a,b,d){var g,e;"function"==typeof d?g=d:e=d;b=b.toLowerCase();if(a[p]&&r[a[p]]&&r[a[p]][b]){d=r[a[p]][b];for(var f=d.length-1;0<=f;f--)if(d[f].key===e||d[f].orig===g)if(a.removeEventListener?a.removeEventListener(b,d[f].func,!1):a.detachEvent&&a.detachEvent("on"+b,d[f].func),d[f].orig=null,d[f].func=null,d.splice(f,1),void 0!==g)break;d.length||delete r[a[p]][b];
if(h.isEmptyObj(r[a[p]])){delete r[a[p]];try{delete a[p]}catch(t){a[p]=void 0}}}},removeAllEvents:function(a,b){void 0!==a[p]&&a[p]&&h.each(r[a[p]],function(d,g){h.removeEvent(a,g,b)})},Uploader:function(a){function b(){var a,e=0,t;if(this.state==h.STARTED){for(t=0;t<f.length;t++)a||f[t].status!=h.QUEUED?e++:(a=f[t],a.status=h.UPLOADING,this.trigger("BeforeUpload",a)&&this.trigger("UploadFile",a));e==f.length&&(this.stop(),this.trigger("UploadComplete",f))}}function d(){var a,b;e.reset();for(a=0;a<
f.length;a++)b=f[a],void 0!==b.size?(e.size+=b.size,e.loaded+=b.loaded):e.size=void 0,b.status==h.DONE?e.uploaded++:b.status==h.FAILED?e.failed++:e.queued++;void 0===e.size?e.percent=0<f.length?Math.ceil(e.uploaded/f.length*100):0:(e.bytesPerSec=Math.ceil(e.loaded/((+new Date-t||1)/1E3)),e.percent=0<e.size?Math.ceil(e.loaded/e.size*100):0)}var g={},e,f=[],t,v=!1;e=new h.QueueProgress;a=h.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},a);h.extend(this,{state:h.STOPPED,
runtime:"",features:{},files:f,settings:a,total:e,id:h.guid(),init:function(){function e(){var a=c[p++],f,b,t;if(a){f=a.getFeatures();if(b=g.settings.required_features)for(b=b.split(","),t=0;t<b.length;t++)if(!f[b[t]]){e();return}a.init(g,function(b){b&&b.success?(g.features=f,g.runtime=a.name,g.trigger("Init",{runtime:a.name}),g.trigger("PostInit"),g.refresh()):e()})}else g.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})}var g=this,v,c,p=0,r;"function"==typeof a.preinit?a.preinit(g):
h.each(a.preinit,function(a,f){g.bind(f,a)});a.page_url=a.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");/^(\w+:\/\/|\/)/.test(a.url)||(a.url=a.page_url+a.url);a.chunk_size=h.parseSize(a.chunk_size);a.max_file_size=h.parseSize(a.max_file_size);g.bind("FilesAdded",function(b,e){var t,d,l=0,v;(t=a.filters)&&t.length&&(v=[],h.each(t,function(a){h.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?v.push("\\.*"):v.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,
"\\$&")+"]","g"),"\\$&"))})}),v=new RegExp(v.join("|")+"$","i"));for(t=0;t<e.length;t++)d=e[t],d.loaded=0,d.percent=0,d.status=h.QUEUED,v&&!v.test(d.name)?b.trigger("Error",{code:h.FILE_EXTENSION_ERROR,message:h.translate("File extension error."),file:d}):void 0!==d.size&&d.size>a.max_file_size?b.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:d}):(f.push(d),l++);if(l)m(function(){g.trigger("QueueChanged");g.refresh()},1);else return!1});a.unique_names&&g.bind("UploadFile",
function(a,f){var b=f.name.match(/\.([^.]+)$/),e="tmp";b&&(e=b[1]);f.target_name=f.id+"."+e});g.bind("UploadProgress",function(a,f){f.percent=0<f.size?Math.ceil(f.loaded/f.size*100):100;d()});g.bind("StateChanged",function(a){if(a.state==h.STARTED)t=+new Date;else if(a.state==h.STOPPED)for(v=a.files.length-1;0<=v;v--)a.files[v].status==h.UPLOADING&&(a.files[v].status=h.QUEUED,d())});g.bind("QueueChanged",d);g.bind("Error",function(a,f){f.file&&(f.file.status=h.FAILED,d(),a.state==h.STARTED&&m(function(){b.call(g)},
1))});g.bind("FileUploaded",function(a,f){f.status=h.DONE;f.loaded=f.size;a.trigger("UploadProgress",f);m(function(){b.call(g)},1)});if(a.runtimes)for(c=[],r=a.runtimes.split(/\s?,\s?/),v=0;v<r.length;v++)k[r[v]]&&c.push(k[r[v]]);else c=k;e();"function"==typeof a.init?a.init(g):h.each(a.init,function(a,f){g.bind(f,a)})},refresh:function(){this.trigger("Refresh")},start:function(){f.length&&this.state!=h.STARTED&&(this.state=h.STARTED,this.trigger("StateChanged"),b.call(this))},stop:function(){this.state!=
h.STOPPED&&(this.state=h.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(a){v=void 0!==a?a:!0;this.trigger("DisableBrowse",v)},getFile:function(a){var b;for(b=f.length-1;0<=b;b--)if(f[b].id===a)return f[b]},removeFile:function(a){var b;for(b=f.length-1;0<=b;b--)if(f[b].id===a.id)return this.splice(b,1)[0]},splice:function(a,b){var e;e=f.splice(void 0===a?0:a,void 0===b?f.length:b);this.trigger("FilesRemoved",e);this.trigger("QueueChanged");return e},trigger:function(a){var f=
g[a.toLowerCase()],b,e;if(f)for(e=Array.prototype.slice.call(arguments),e[0]=this,b=0;b<f.length;b++)if(!1===f[b].func.apply(f[b].scope,e))return!1;return!0},hasEventListener:function(a){return!!g[a.toLowerCase()]},bind:function(a,f,b){var e;a=a.toLowerCase();e=g[a]||[];e.push({func:f,scope:b||this});g[a]=e},unbind:function(a,f){a=a.toLowerCase();var b=g[a],e;if(b){if(void 0!==f)for(e=b.length-1;0<=e;e--){if(b[e].func===f){b.splice(e,1);break}}else b=[];b.length||delete g[a]}},unbindAll:function(){var a=
this;h.each(g,function(f,b){a.unbind(b)})},destroy:function(){this.stop();this.trigger("Destroy");this.unbindAll()}})},File:function(a,b,d){this.id=a;this.name=b;this.size=d;this.status=this.percent=this.loaded=0},Runtime:function(){this.getFeatures=function(){};this.init=function(a,b){}},QueueProgress:function(){var a=this;a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},
runtimes:{}};window.plupload=h})();
(function(){if(!window.google||!google.gears){var c=null;if("undefined"!=typeof GearsFactory)c=new GearsFactory;else try{c=new ActiveXObject("Gears.Factory"),-1!=c.getBuildInfo().indexOf("ie_mobile")&&c.privateSetGlobalObject(this)}catch(b){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(c=document.createElement("object"),c.style.display="none",c.width=0,c.height=0,c.type="application/x-googlegears",document.documentElement.appendChild(c))}c&&(window.google||
(window.google={}),google.gears||(google.gears={factory:c}))}})();
(function(c,b,a,k){function n(a,b,c){var r,p;r=google.gears.factory.create("beta.canvas");try{if(r.decode(a),b.width||(b.width=r.width),b.height||(b.height=r.height),p=Math.min(width/r.width,height/r.height),1>p||1===p&&"image/jpeg"===c)return r.resize(Math.round(r.width*p),Math.round(r.height*p)),b.quality?r.encode(c,{quality:b.quality/100}):r.encode(c)}catch(h){}return a}var u={};a.runtimes.Gears=a.addRuntime("gears",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,
progress:!0,multipart:!0,multi_selection:!0}},init:function(k,d){function m(b){var d,c,g=[],e;for(c=0;c<b.length;c++)d=b[c],e=a.guid(),u[e]=d.blob,g.push(new a.File(e,d.name,d.blob.length));k.trigger("FilesAdded",g)}var r,p,h=!1;if(!c.google||!google.gears)return d({success:!1});try{r=google.gears.factory.create("beta.desktop")}catch(q){return d({success:!1})}k.bind("PostInit",function(){var d=k.settings,l=b.getElementById(d.drop_element);l&&(a.addEvent(l,"dragover",function(a){r.setDropEffect(a,
"copy");a.preventDefault()},k.id),a.addEvent(l,"drop",function(a){var b=r.getDragData(a,"application/x-gears-files");b&&m(b.files);a.preventDefault()},k.id),l=0);a.addEvent(b.getElementById(d.browse_button),"click",function(a){var b=[],e,f;a.preventDefault();if(!h){a=0;a:for(;a<d.filters.length;a++)for(f=d.filters[a].extensions.split(","),e=0;e<f.length;e++){if("*"===f[e]){b=[];break a}b.push("."+f[e])}r.openFiles(m,{singleFile:!d.multi_selection,filter:b})}},k.id)});k.bind("CancelUpload",function(){p.abort&&
p.abort()});k.bind("UploadFile",function(b,d){function c(){function v(f){var e,t="----pluploadboundary"+a.guid(),g;r&&(p.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e=google.gears.factory.create("beta.blobbuilder"),a.each(a.extend(n,b.settings.multipart_params),function(a,b){e.append("--"+t+'\r\nContent-Disposition: form-data; name="'+b+'"\r\n\r\n');e.append(a+"\r\n")}),g=a.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",e.append("--"+
t+'\r\nContent-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+d.name+'"\r\nContent-Type: '+g+"\r\n\r\n"),e.append(f),e.append("\r\n--"+t+"--\r\n"),g=e.getAsBlob(),k=g.length-f.length,f=g);p.send(f)}var m,r=b.settings.multipart,k=0,n={name:d.target_name||d.name},w=b.settings.url;d.status!=a.DONE&&d.status!=a.FAILED&&b.state!=a.STOPPED&&(h&&(n.chunk=g,n.chunks=e),m=Math.min(f,d.size-g*f),r||(w=a.buildUrl(b.settings.url,n)),p=google.gears.factory.create("beta.httprequest"),
p.open("POST",w),r||(p.setRequestHeader("Content-Disposition",'attachment; filename="'+d.name+'"'),p.setRequestHeader("Content-Type","application/octet-stream")),a.each(b.settings.headers,function(a,b){p.setRequestHeader(b,a)}),p.upload.onprogress=function(a){d.loaded=t+a.loaded-k;b.trigger("UploadProgress",d)},p.onreadystatechange=function(){var f;4==p.readyState&&b.state!==a.STOPPED&&(200==p.status?(f={chunk:g,chunks:e,response:p.responseText,status:p.status},b.trigger("ChunkUploaded",d,f),f.cancelled?
d.status=a.FAILED:(t+=m,++g>=e?(d.status=a.DONE,b.trigger("FileUploaded",d,{response:p.responseText,status:p.status})):c())):b.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:d,chunk:g,chunks:e,status:p.status}))},g<e&&v(u[d.id].slice(g*f,m)))}var g=0,e,f,t=0,v=b.settings.resize,h;v&&/\.(png|jpg|jpeg)$/i.test(d.name)&&(u[d.id]=n(u[d.id],v,/\.png$/i.test(d.name)?"image/png":"image/jpeg"));d.size=u[d.id].length;f=b.settings.chunk_size;h=0<f;e=Math.ceil(d.size/f);h||(f=d.size,
e=1);c()});k.bind("DisableBrowse",function(a,b){h=b});k.bind("Destroy",function(d){var c,h,g={browseButton:d.settings.browse_button,dropElm:d.settings.drop_element};for(c in g)(h=b.getElementById(g[c]))&&a.removeAllEvents(h,d.id)});d({success:!0})}})})(window,document,plupload);
(function(c,b,a,k){function n(a){var b,d=typeof a,c;if(a===k||null===a)return"null";if("string"===d)return b="\bb\tt\nn\ff\rr\"\"''\\\\",'"'+a.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(a,d){var c=b.indexOf(d);if(c+1)return"\\"+b.charAt(c+1);a=d.charCodeAt().toString(16);return"\\u"+"0000".substring(a.length)+a})+'"';if("object"==d){d=a.length!==k;b="";if(d){for(c=0;c<a.length;c++)b&&(b+=","),b+=n(a[c]);b="["+b+"]"}else{for(c in a)a.hasOwnProperty(c)&&(b&&(b+=","),b+=n(c)+":"+n(a[c]));b="{"+
b+"}"}return b}return""+a}function u(a){var b=!1,d=null,c,q,l,y,g,e=0;try{try{d=new ActiveXObject("AgControl.AgControl"),d.IsVersionSupported(a)&&(b=!0)}catch(t){var f=navigator.plugins["Silverlight Plug-In"];if(f){c=f.description;"1.0.30226.2"===c&&(c="2.0.30226.2");for(q=c.split(".");3<q.length;)q.pop();for(;4>q.length;)q.push(0);for(l=a.split(".");4<l.length;)l.pop();do y=parseInt(l[e],10),g=parseInt(q[e],10),e++;while(e<l.length&&y===g);y<=g&&!isNaN(y)&&(b=!0)}}}catch(t){b=!1}return b}var w={},
d={};a.silverlight={trigger:function(b,d){var c=w[b],h;c&&(h=a.toArray(arguments).slice(1),h[0]="Silverlight:"+d,setTimeout(function(){c.trigger.apply(c,h)},0))}};a.runtimes.Silverlight=a.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(m,r){function p(){return b.getElementById(m.id+"_silverlight").content.Upload}var h,q="",l=m.settings.filters,y,g=b.body;if(!u("2.0.31005.0")||c.opera&&c.opera.buildNumber)r({success:!1});
else{d[m.id]=!1;w[m.id]=m;h=b.createElement("div");h.id=m.id+"_silverlight_container";a.extend(h.style,{position:"absolute",top:"0px",background:m.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:m.settings.shim_bgcolor||8<b.documentMode?"":.01});h.className="plupload silverlight";m.settings.container&&(g=b.getElementById(m.settings.container),"static"===a.getStyle(g,"position")&&(g.style.position="relative"));g.appendChild(h);for(y=0;y<l.length;y++)q+=
(""!=q?"|":"")+l[y].title+" | *."+l[y].extensions.replace(/,/g,";*.");h.innerHTML='<object id="'+m.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024"><param name="source" value="'+m.settings.silverlight_xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="id='+m.id+",filter="+q+",multiselect="+
m.settings.multi_selection+'"/></object>';m.bind("Silverlight:Init",function(){var e,f={};d[m.id]||(d[m.id]=!0,m.bind("Silverlight:StartSelectFiles",function(a){e=[]}),m.bind("Silverlight:SelectFile",function(b,d,g,c){b=a.guid();f[b]=d;f[d]=b;e.push(new a.File(b,g,c))}),m.bind("Silverlight:SelectSuccessful",function(){e.length&&m.trigger("FilesAdded",e)}),m.bind("Silverlight:UploadChunkError",function(b,e,d,g,c){m.trigger("Error",{code:a.IO_ERROR,message:"IO Error.",details:c,file:b.getFile(f[e])})}),
m.bind("Silverlight:UploadFileProgress",function(b,e,d,g){e=b.getFile(f[e]);e.status!=a.FAILED&&(e.size=g,e.loaded=d,b.trigger("UploadProgress",e))}),m.bind("Refresh",function(f){var e,d;if(e=b.getElementById(f.settings.browse_button))d=a.getPos(e,b.getElementById(f.settings.container)),e=a.getSize(e),a.extend(b.getElementById(f.id+"_silverlight_container").style,{top:d.y+"px",left:d.x+"px",width:e.w+"px",height:e.h+"px"})}),m.bind("Silverlight:UploadChunkSuccessful",function(b,e,d,g,c){e=b.getFile(f[e]);
b.trigger("ChunkUploaded",e,{chunk:d,chunks:g,response:c});e.status!=a.FAILED&&b.state!==a.STOPPED&&p().UploadNextChunk();d==g-1&&(e.status=a.DONE,b.trigger("FileUploaded",e,{response:c}))}),m.bind("Silverlight:UploadSuccessful",function(b,e,d){e=b.getFile(f[e]);e.status=a.DONE;b.trigger("FileUploaded",e,{response:d})}),m.bind("FilesRemoved",function(a,b){var e;for(e=0;e<b.length;e++)p().RemoveFile(f[b[e].id])}),m.bind("UploadFile",function(b,e){var d=b.settings,g=d.resize||{};p().UploadFile(f[e.id],
b.settings.url,n({name:e.target_name||e.name,mime:a.mimeTypes[e.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:d.chunk_size,image_width:g.width,image_height:g.height,image_quality:g.quality||90,multipart:!!d.multipart,multipart_params:d.multipart_params||{},file_data_name:d.file_data_name,headers:d.headers}))}),m.bind("CancelUpload",function(){p().CancelUpload()}),m.bind("Silverlight:MouseEnter",function(e){var f;f=b.getElementById(m.settings.browse_button);
e=e.settings.browse_button_hover;f&&e&&a.addClass(f,e)}),m.bind("Silverlight:MouseLeave",function(e){var f;f=b.getElementById(m.settings.browse_button);e=e.settings.browse_button_hover;f&&e&&a.removeClass(f,e)}),m.bind("Silverlight:MouseLeftButtonDown",function(e){var f,d;f=b.getElementById(m.settings.browse_button);d=e.settings.browse_button_active;f&&d&&(a.addClass(f,d),a.addEvent(b.body,"mouseup",function(){a.removeClass(f,d)}))}),m.bind("Sliverlight:StartSelectFiles",function(e){var f;f=b.getElementById(m.settings.browse_button);
e=e.settings.browse_button_active;f&&e&&a.removeClass(f,e)}),m.bind("DisableBrowse",function(a,b){p().DisableBrowse(b)}),m.bind("Destroy",function(e){a.removeAllEvents(b.body,e.id);delete d[e.id];delete w[e.id];(e=b.getElementById(e.id+"_silverlight_container"))&&g.removeChild(e)}),r({success:!0}))})}}})})(window,document,plupload);
(function(c,b,a,k){function n(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+"."+a[1])}var u={},w={};a.flash={trigger:function(a,b,c){setTimeout(function(){var p=u[a];p&&p.trigger("Flash:"+b,c)},0)}};a.runtimes.Flash=a.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,
progress:!0,multipart:!0,multi_selection:!0}},init:function(d,c){function k(){return b.getElementById(d.id+"_flash")}function p(){5E3<q++?c({success:!1}):!1===w[d.id]&&setTimeout(p,1)}var h,q=0,l=b.body;10>n()?c({success:!1}):(w[d.id]=!1,u[d.id]=d,b.getElementById(d.settings.browse_button),h=b.createElement("div"),h.id=d.id+"_flash_container",a.extend(h.style,{position:"absolute",top:"0px",background:d.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),h.className="plupload flash",
d.settings.container&&(l=b.getElementById(d.settings.container),"static"===a.getStyle(l,"position")&&(l.style.position="relative")),l.appendChild(h),function(){var c,g;c='<object id="'+d.id+'_flash" type="application/x-shockwave-flash" data="'+d.settings.flash_swf_url+'" ';a.ua.ie&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+d.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(d.id)+
'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';a.ua.ie?(g=b.createElement("div"),h.appendChild(g),g.outerHTML=c):h.innerHTML=c}(),p(),h=null,d.bind("Destroy",function(d){a.removeAllEvents(b.body,d.id);delete w[d.id];delete u[d.id];(d=b.getElementById(d.id+"_flash_container"))&&l.removeChild(d)}),d.bind("Flash:Init",function(){var l={};try{k().setFileFilters(d.settings.filters,d.settings.multi_selection)}catch(g){c({success:!1});return}w[d.id]||
(w[d.id]=!0,d.bind("UploadFile",function(b,e){var f=b.settings,c=d.settings.resize||{};k().uploadFile(l[e.id],f.url,{name:e.target_name||e.name,mime:a.mimeTypes[e.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:f.chunk_size,width:c.width,height:c.height,quality:c.quality,multipart:f.multipart,multipart_params:f.multipart_params||{},file_data_name:f.file_data_name,format:/\.(jpg|jpeg)$/i.test(e.name)?"jpg":"png",headers:f.headers,urlstream_upload:f.urlstream_upload})}),
d.bind("CancelUpload",function(){k().cancelUpload()}),d.bind("Flash:UploadProcess",function(b,e){var f=b.getFile(l[e.id]);f.status!=a.FAILED&&(f.loaded=e.loaded,f.size=e.size,b.trigger("UploadProgress",f))}),d.bind("Flash:UploadChunkComplete",function(b,e){var f=b.getFile(l[e.id]);b.trigger("ChunkUploaded",f,{chunk:e.chunk,chunks:e.chunks,response:e.text});f.status!==a.FAILED&&b.state!==a.STOPPED&&k().uploadNextChunk();e.chunk==e.chunks-1&&(f.status=a.DONE,b.trigger("FileUploaded",f,{response:e.text}))}),
d.bind("Flash:SelectFiles",function(b,e){var f,c,v=[],q;for(c=0;c<e.length;c++)f=e[c],q=a.guid(),l[q]=f.id,l[f.id]=q,v.push(new a.File(q,f.name,f.size));v.length&&d.trigger("FilesAdded",v)}),d.bind("Flash:SecurityError",function(b,e){d.trigger("Error",{code:a.SECURITY_ERROR,message:a.translate("Security error."),details:e.message,file:d.getFile(l[e.id])})}),d.bind("Flash:GenericError",function(b,e){d.trigger("Error",{code:a.GENERIC_ERROR,message:a.translate("Generic error."),details:e.message,file:d.getFile(l[e.id])})}),
d.bind("Flash:IOError",function(b,e){d.trigger("Error",{code:a.IO_ERROR,message:a.translate("IO error."),details:e.message,file:d.getFile(l[e.id])})}),d.bind("Flash:ImageError",function(b,e){d.trigger("Error",{code:parseInt(e.code,10),message:a.translate("Image error."),file:d.getFile(l[e.id])})}),d.bind("Flash:StageEvent:rollOver",function(c){var e;e=b.getElementById(d.settings.browse_button);c=c.settings.browse_button_hover;e&&c&&a.addClass(e,c)}),d.bind("Flash:StageEvent:rollOut",function(c){var e;
e=b.getElementById(d.settings.browse_button);c=c.settings.browse_button_hover;e&&c&&a.removeClass(e,c)}),d.bind("Flash:StageEvent:mouseDown",function(c){var e,f;e=b.getElementById(d.settings.browse_button);f=c.settings.browse_button_active;e&&f&&(a.addClass(e,f),a.addEvent(b.body,"mouseup",function(){a.removeClass(e,f)},c.id))}),d.bind("Flash:StageEvent:mouseUp",function(c){var e;e=b.getElementById(d.settings.browse_button);c=c.settings.browse_button_active;e&&c&&a.removeClass(e,c)}),d.bind("Flash:ExifData",
function(a,b){d.trigger("ExifData",d.getFile(l[b.id]),b.data)}),d.bind("Flash:GpsData",function(a,b){d.trigger("GpsData",d.getFile(l[b.id]),b.data)}),d.bind("QueueChanged",function(a){d.refresh()}),d.bind("FilesRemoved",function(a,b){var f;for(f=0;f<b.length;f++)k().removeFile(l[b[f].id])}),d.bind("StateChanged",function(a){d.refresh()}),d.bind("Refresh",function(c){var e,f;k().setFileFilters(d.settings.filters,d.settings.multi_selection);if(e=b.getElementById(c.settings.browse_button))f=a.getPos(e,
b.getElementById(c.settings.container)),e=a.getSize(e),a.extend(b.getElementById(c.id+"_flash_container").style,{top:f.y+"px",left:f.x+"px",width:e.w+"px",height:e.h+"px"})}),d.bind("DisableBrowse",function(a,b){k().disableBrowse(b)}),c({success:!0}))}))}})})(window,document,plupload);
(function(c){c.runtimes.BrowserPlus=c.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(b,a){function k(a){var d,h=[],q,l;for(d=0;d<a.length;d++)q=a[d],l=c.guid(),w[l]=q,h.push(new c.File(l,q.name,q.size));d&&b.trigger("FilesAdded",h)}function n(){var r=!1;b.bind("PostInit",function(){function a(b,f){u.DragAndDrop.AddDropTarget({id:b},function(a){u.DragAndDrop.AttachCallbacks({id:b,hover:function(a){!a&&
f&&f()},drop:function(a){f&&f();k(a)}},function(){})})}function h(){document.getElementById(m).style.top="-1000px"}var q,l=d.drop_element,m=b.id+"_droptarget",g=document.getElementById(l);g&&(document.attachEvent&&/MSIE/gi.test(navigator.userAgent)?(q=document.createElement("div"),q.setAttribute("id",m),c.extend(q.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0}),document.body.appendChild(q),c.addEvent(g,"dragenter",function(a){var b;a=document.getElementById(l);
b=c.getPos(a);c.extend(document.getElementById(m).style,{top:b.y+"px",left:b.x+"px",width:a.offsetWidth+"px",height:a.offsetHeight+"px"})}),a(m,h)):a(l));c.addEvent(document.getElementById(d.browse_button),"click",function(a){var b=[],g,l=d.filters,q,h;a.preventDefault();if(!r){a=0;a:for(;a<l.length;a++)for(q=l[a].extensions.split(","),g=0;g<q.length;g++){if("*"===q[g]){b=[];break a}(h=c.mimeTypes[q[g]])&&-1===c.inArray(h,b)&&b.push(c.mimeTypes[q[g]])}u.FileBrowse.OpenBrowseDialog({mimeTypes:b},function(a){a.success&&
k(a.value)})}});g=q=null});b.bind("CancelUpload",function(){u.Uploader.cancel({},function(){})});b.bind("DisableBrowse",function(a,b){r=b});b.bind("UploadFile",function(a,b){function d(l,m){var k;b.status!=c.FAILED&&(g.name=b.target_name||b.name,e&&(g.chunk=""+l,g.chunks=""+m),k=t.shift(),u.Uploader.upload({url:a.settings.url,files:{file:k},cookies:document.cookies,postvars:c.extend(g,a.settings.multipart_params),progressCallback:function(e){var d=0;f[l]=parseInt(e.filePercent*k.size/100,10);for(e=
0;e<f.length;e++)d+=f[e];b.loaded=d;a.trigger("UploadProgress",b)}},function(f){var g;f.success?(g=f.value.statusCode,e&&a.trigger("ChunkUploaded",b,{chunk:l,chunks:m,response:f.value.body,status:g}),0<t.length?d(++l,m):(b.status=c.DONE,a.trigger("FileUploaded",b,{response:f.value.body,status:g}),400<=g&&a.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:b,status:g}))):a.trigger("Error",{code:c.GENERIC_ERROR,message:c.translate("Generic Error."),file:b,details:f.error})}))}
function l(a){b.size=a.size;e?u.FileAccess.chunk({file:a,chunkSize:e},function(a){if(a.success){a=a.value;var b=a.length;f=Array(b);for(var e=0;e<b;e++)f[e]=0,t.push(a[e]);d(0,b)}}):(f=Array(1),t.push(a),d(0,1))}var k=w[b.id],g={},e=a.settings.chunk_size,f,t=[];m&&/\.(png|jpg|jpeg)$/i.test(b.name)?BrowserPlus.ImageAlter.transform({file:k,quality:m.quality||90,actions:[{scale:{maxwidth:m.width,maxheight:m.height}}]},function(a){a.success&&l(a.value.file)}):l(k)});a({success:!0})}var u=window.BrowserPlus,
w={},d=b.settings,m=d.resize;u?u.init(function(b){var d=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];m&&d.push({service:"ImageAlter",version:"4"});b.success?u.require({services:d},function(b){b.success?n():a()}):a()}):a()}})})(plupload);
(function(c,b,a,k){function n(a,b){var d;if("FileReader"in c)d=new FileReader,d.readAsDataURL(a),d.onload=function(){b(d.result)};else return b(a.getAsDataURL())}function u(a,b){var d;if("FileReader"in c)d=new FileReader,d.readAsBinaryString(a),d.onload=function(){b(d.result)};else return b(a.getAsBinary())}function w(a,d,c,g){var e,f,t,v,h=this;n(p[a.id],function(k){e=b.createElement("canvas");e.style.display="none";b.body.appendChild(e);f=e.getContext("2d");t=new Image;t.onerror=t.onabort=function(){g({success:!1})};
t.onload=function(){var b,x,p,n;d.width||(d.width=t.width);d.height||(d.height=t.height);v=Math.min(d.width/t.width,d.height/t.height);if(1>v||1===v&&"image/jpeg"===c){b=Math.round(t.width*v);x=Math.round(t.height*v);e.width=b;e.height=x;f.drawImage(t,0,0,b,x);if("image/jpeg"===c){if(p=new m(atob(k.substring(k.indexOf("base64,")+7))),p.headers&&p.headers.length&&(n=new r,n.init(p.get("exif")[0])&&(n.setExif("PixelXDimension",b),n.setExif("PixelYDimension",x),p.set("exif",n.getBinary()),h.hasEventListener("ExifData")&&
h.trigger("ExifData",a,n.EXIF()),h.hasEventListener("GpsData")&&h.trigger("GpsData",a,n.GPS()))),d.quality)try{k=e.toDataURL(c,d.quality/100)}catch(u){k=e.toDataURL(c)}}else k=e.toDataURL(c);k=k.substring(k.indexOf("base64,")+7);k=atob(k);p&&p.headers&&p.headers.length&&(k=p.restore(k),p.purge());e.parentNode.removeChild(e);g({success:!0,data:k})}else g({success:!1})};t.src=k})}function d(){function a(b,f){var l=d?0:-8*(f-1),q=0,k;for(k=0;k<f;k++)q|=c.charCodeAt(b+k)<<Math.abs(l+8*k);return q}function b(a,
f,d){d=3===arguments.length?d:c.length-f-1;c=c.substr(0,f)+a+c.substr(d+f)}var d=!1,c;return{II:function(a){if(a===k)return d;d=a},init:function(a){d=!1;c=a},SEGMENT:function(a,f,d){switch(arguments.length){case 1:return c.substr(a,c.length-a-1);case 2:return c.substr(a,f);case 3:b(d,a,f);break;default:return c}},BYTE:function(b){return a(b,1)},SHORT:function(b){return a(b,2)},LONG:function(e,f){if(f===k)return a(e,4);var c="",g=d?0:-24,m;for(m=0;4>m;m++)c+=String.fromCharCode(f>>Math.abs(g+8*m)&
255);b(c,e,4)},SLONG:function(b){b=a(b,4);return 2147483647<b?b-4294967296:b},STRING:function(b,f){var d="";for(f+=b;b<f;b++)d+=String.fromCharCode(a(b,1));return d}}}function m(a){var b={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},c=[],g,e,f=k,t=0;g=new d;g.init(a);if(65496===g.SHORT(0)){e=2;for(a=Math.min(1048576,a.length);e<=a;)if(f=g.SHORT(e),65488<=f&&65495>=f)e+=2;
else{if(65498===f||65497===f)break;t=g.SHORT(e+2)+2;b[f]&&g.STRING(e+4,b[f].signature.length)===b[f].signature&&c.push({hex:f,app:b[f].app.toUpperCase(),name:b[f].name.toUpperCase(),start:e,length:t,segment:g.SEGMENT(e,t)});e+=t}g.init(null);return{headers:c,restore:function(a){g.init(a);var b=new m(a);if(!b.headers)return!1;for(a=b.headers.length;0<a;a--){var d=b.headers[a-1];g.SEGMENT(d.start,d.length,"")}b.purge();e=65504==g.SHORT(2)?4+g.SHORT(4):2;a=0;for(b=c.length;a<b;a++)g.SEGMENT(e,0,c[a].segment),
e+=c[a].length;return g.SEGMENT()},get:function(a){for(var b=[],d=0,f=c.length;d<f;d++)c[d].app===a.toUpperCase()&&b.push(c[d].segment);return b},set:function(a,b){var d=[];"string"===typeof b?d.push(b):d=b;for(var f=ii=0,e=c.length;f<e&&!(c[f].app===a.toUpperCase()&&(c[f].segment=d[ii],c[f].length=d[ii].length,ii++),ii>=d.length);f++);},purge:function(){c=[];g.init(null)}}}}function r(){function b(a,d){var m=c.SHORT(a),q,h,p,x,n,r=[],u={};for(q=0;q<m;q++)if(n=a+12*q+2,p=d[c.SHORT(n)],p!==k){h=c.SHORT(n+=
2);x=c.LONG(n+=2);n+=4;r=[];switch(h){case 1:case 7:4<x&&(n=c.LONG(n)+g.tiffHeader);for(h=0;h<x;h++)r[h]=c.BYTE(n+h);break;case 2:4<x&&(n=c.LONG(n)+g.tiffHeader);u[p]=c.STRING(n,x-1);continue;case 3:2<x&&(n=c.LONG(n)+g.tiffHeader);for(h=0;h<x;h++)r[h]=c.SHORT(n+2*h);break;case 4:1<x&&(n=c.LONG(n)+g.tiffHeader);for(h=0;h<x;h++)r[h]=c.LONG(n+4*h);break;case 5:n=c.LONG(n)+g.tiffHeader;for(h=0;h<x;h++)r[h]=c.LONG(n+4*h)/c.LONG(n+4*h+4);break;case 9:n=c.LONG(n)+g.tiffHeader;for(h=0;h<x;h++)r[h]=c.SLONG(n+
4*h);break;case 10:n=c.LONG(n)+g.tiffHeader;for(h=0;h<x;h++)r[h]=c.SLONG(n+4*h)/c.SLONG(n+4*h+4);break;default:continue}x=1==x?r[0]:r;e.hasOwnProperty(p)&&"object"!=typeof x?u[p]=e[p][x]:u[p]=x}return u}var c,m,g={},e;c=new d;m={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",
37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};e={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",
2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",
9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(a){g={tiffHeader:10};
if(a===k||!a.length)return!1;c.init(a);return 65505===c.SHORT(0)&&"EXIF\x00"===c.STRING(4,5).toUpperCase()?(a=k,a=g.tiffHeader,c.II(18761==c.SHORT(a)),42!==c.SHORT(a+=2)?a=!1:(g.IFD0=g.tiffHeader+c.LONG(a+2),a=b(g.IFD0,m.tiff),g.exifIFD="ExifIFDPointer"in a?g.tiffHeader+a.ExifIFDPointer:k,g.gpsIFD="GPSInfoIFDPointer"in a?g.tiffHeader+a.GPSInfoIFDPointer:k,a=!0),a):!1},EXIF:function(){var d;d=b(g.exifIFD,m.exif);if(d.ExifVersion&&"array"===a.typeOf(d.ExifVersion)){for(var c=0,e="";c<d.ExifVersion.length;c++)e+=
String.fromCharCode(d.ExifVersion[c]);d.ExifVersion=e}return d},GPS:function(){var a;a=b(g.gpsIFD,m.gps);a.GPSVersionID&&(a.GPSVersionID=a.GPSVersionID.join("."));return a},setExif:function(a,b){if("PixelXDimension"!==a&&"PixelYDimension"!==a)return!1;var d;d=a;var e,h,k,q=0;if("string"===typeof d)for(hex in e=m.exif,e)if(e[hex]===d){d=hex;break}e=g.exifIFD;h=c.SHORT(e);for(i=0;i<h;i++)if(k=e+12*i+2,c.SHORT(k)==d){q=k+8;break}q?(c.LONG(q,b),d=!0):d=!1;return d},getBinary:function(){return c.SEGMENT()}}}
var p={},h;a.runtimes.Html5=a.addRuntime("html5",{getFeatures:function(){var d,m,k,g,e,f;m=k=e=f=!1;c.XMLHttpRequest&&(d=new XMLHttpRequest,k=!!d.upload,m=!(!d.sendAsBinary&&!d.upload));m&&(g=!!(d.sendAsBinary||c.Uint8Array&&c.ArrayBuffer),e=!(!File||!File.prototype.getAsDataURL&&!c.FileReader||!g),f=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)));h=a.ua.safari&&a.ua.windows;d=m;m=b.createElement("div");return{html5:d,dragdrop:"draggable"in m||"ondragstart"in
m&&"ondrop"in m,jpgresize:e,pngresize:e,multipart:e||!!c.FileReader||!!c.FormData,canSendBinary:g,cantSendBlobInFormData:!(!(a.ua.gecko&&c.FormData&&c.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:k,chunks:f,multi_selection:!(a.ua.safari&&a.ua.windows),triggerDialog:a.ua.gecko&&c.FormData||a.ua.webkit}},init:function(d,m){function k(b){var c,e,g=[],h,m={};for(e=0;e<b.length;e++)c=b[e],m[c.name]||(m[c.name]=!0,h=a.guid(),p[h]=c,g.push(new a.File(h,c.fileName||c.name,c.fileSize||c.size)));
g.length&&d.trigger("FilesAdded",g)}var g,e;g=this.getFeatures();g.html5?(d.bind("Init",function(c){var e,g,h=[],m,n,l=c.settings.filters,p,r;m=b.body;e=b.createElement("div");e.id=c.id+"_html5_container";a.extend(e.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:d.settings.shim_bgcolor?"":0});e.className="plupload html5";d.settings.container&&(m=b.getElementById(d.settings.container),"static"===a.getStyle(m,
"position")&&(m.style.position="relative"));m.appendChild(e);m=0;a:for(;m<l.length;m++)for(p=l[m].extensions.split(/,/),n=0;n<p.length;n++){if("*"===p[n]){h=[];break a}(r=a.mimeTypes[p[n]])&&-1===a.inArray(r,h)&&h.push(r)}e.innerHTML='<input id="'+d.id+'_html5"  style="font-size:999px" type="file" accept="'+h.join(",")+'" '+(d.settings.multi_selection&&d.features.multi_selection?'multiple="multiple"':"")+" />";e.scrollTop=100;h=b.getElementById(d.id+"_html5");c.features.triggerDialog?a.extend(h.style,
{position:"absolute",width:"100%",height:"100%"}):a.extend(h.style,{cssFloat:"right",styleFloat:"right"});h.onchange=function(){k(this.files);this.value=""};if(g=b.getElementById(c.settings.browse_button)){var u=c.settings.browse_button_hover,w=c.settings.browse_button_active;e=c.features.triggerDialog?g:e;u&&(a.addEvent(e,"mouseover",function(){a.addClass(g,u)},c.id),a.addEvent(e,"mouseout",function(){a.removeClass(g,u)},c.id));w&&(a.addEvent(e,"mousedown",function(){a.addClass(g,w)},c.id),a.addEvent(b.body,
"mouseup",function(){a.removeClass(g,w)},c.id));c.features.triggerDialog&&a.addEvent(g,"click",function(a){var d=b.getElementById(c.id+"_html5");d&&!d.disabled&&d.click();a.preventDefault()},c.id)}}),d.bind("PostInit",function(){var c=b.getElementById(d.settings.drop_element);c&&(h?a.addEvent(c,"dragenter",function(e){var g;g=b.getElementById(d.id+"_drop");g||(g=b.createElement("input"),g.setAttribute("type","file"),g.setAttribute("id",d.id+"_drop"),g.setAttribute("multiple","multiple"),a.addEvent(g,
"change",function(){k(this.files);a.removeEvent(g,"change",d.id);g.parentNode.removeChild(g)},d.id),c.appendChild(g));a.getPos(c,b.getElementById(d.settings.container));e=a.getSize(c);"static"===a.getStyle(c,"position")&&a.extend(c.style,{position:"relative"});a.extend(g.style,{position:"absolute",display:"block",top:0,left:0,width:e.w+"px",height:e.h+"px",opacity:0})},d.id):(a.addEvent(c,"dragover",function(a){a.preventDefault()},d.id),a.addEvent(c,"drop",function(a){var b=a.dataTransfer;b&&b.files&&
k(b.files);a.preventDefault()},d.id)))}),d.bind("Refresh",function(c){var e,g,h;if(e=b.getElementById(d.settings.browse_button))g=a.getPos(e,b.getElementById(c.settings.container)),h=a.getSize(e),c=b.getElementById(d.id+"_html5_container"),a.extend(c.style,{top:g.y+"px",left:g.x+"px",width:h.w+"px",height:h.h+"px"}),d.features.triggerDialog&&("static"===a.getStyle(e,"position")&&a.extend(e.style,{position:"relative"}),g=parseInt(a.getStyle(e,"z-index"),10),isNaN(g)&&(g=0),a.extend(e.style,{zIndex:g}),
a.extend(c.style,{zIndex:g-1}))}),d.bind("DisableBrowse",function(a,d){var c=b.getElementById(a.id+"_html5");c&&(c.disabled=d)}),d.bind("CancelUpload",function(){e&&e.abort&&e.abort()}),d.bind("UploadFile",function(b,d){function h(a,b,d){var c;if(File.prototype.slice)try{return a.slice(),a.slice(b,d)}catch(e){return a.slice(b,d-b)}else return(c=File.prototype.webkitSlice||File.prototype.mozSlice)?c.call(a,b,d):null}function m(n){function l(){function m(h){var k=0,n="----pluploadboundary"+a.guid(),
r,x="";e=new XMLHttpRequest;e.upload&&(e.upload.onprogress=function(a){d.loaded=Math.min(d.size,q+a.loaded-k);b.trigger("UploadProgress",d)});e.onreadystatechange=function(){var c,g;if(4==e.readyState&&b.state!==a.STOPPED){try{c=e.status}catch(m){c=0}if(400<=c)b.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:d,status:c});else{if(w){g={chunk:p,chunks:w,response:e.responseText,status:c};b.trigger("ChunkUploaded",d,g);q+=z;if(g.cancelled){d.status=a.FAILED;return}d.loaded=
Math.min(d.size,(p+1)*y)}else d.loaded=d.size;b.trigger("UploadProgress",d);h=u=r=x=null;!w||++p>=w?(d.status=a.DONE,b.trigger("FileUploaded",d,{response:e.responseText,status:c})):l()}}};if(b.settings.multipart&&g.multipart){A.name=d.target_name||d.name;e.open("post",D,!0);a.each(b.settings.headers,function(a,b){e.setRequestHeader(b,a)});if("string"!==typeof h&&c.FormData){r=new FormData;a.each(a.extend(A,b.settings.multipart_params),function(a,b){r.append(b,a)});r.append(b.settings.file_data_name,
h);e.send(r);return}if("string"===typeof h){e.setRequestHeader("Content-Type","multipart/form-data; boundary="+n);a.each(a.extend(A,b.settings.multipart_params),function(a,b){x+="--"+n+'\r\nContent-Disposition: form-data; name="'+b+'"\r\n\r\n';x+=unescape(encodeURIComponent(a))+"\r\n"});E=a.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";x+="--"+n+'\r\nContent-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(d.name))+
'"\r\nContent-Type: '+E+"\r\n\r\n"+h+"\r\n--"+n+"--\r\n";k=x.length-h.length;h=x;if(e.sendAsBinary)e.sendAsBinary(h);else if(g.canSendBinary){for(var v=new Uint8Array(h.length),C=0;C<h.length;C++)v[C]=h.charCodeAt(C)&255;e.send(v.buffer)}return}}D=a.buildUrl(b.settings.url,a.extend(A,b.settings.multipart_params));e.open("post",D,!0);e.setRequestHeader("Content-Type","application/octet-stream");a.each(b.settings.headers,function(a,b){e.setRequestHeader(b,a)});e.send(h)}var u,w,A,y,z,E,D=b.settings.url;
d.status!=a.DONE&&d.status!=a.FAILED&&b.state!=a.STOPPED&&(A={name:d.target_name||d.name},k.chunk_size&&d.size>k.chunk_size&&(g.chunks||"string"==typeof n)?(y=k.chunk_size,w=Math.ceil(d.size/y),z=Math.min(y,d.size-p*y),u="string"==typeof n?n.substring(p*y,p*y+z):h(n,p*y,p*y+z),A.chunk=p,A.chunks=w):(z=d.size,u=n),b.settings.multipart&&g.multipart&&"string"!==typeof u&&r&&g.cantSendBlobInFormData&&g.chunks&&b.settings.chunk_size?(r.onload=function(){m(r.result)},r.readAsBinaryString(u)):m(u))}var p=
0,q=0,r="FileReader"in c?new FileReader:null;l()}var k=b.settings,n;n=p[d.id];g.jpgresize&&b.settings.resize&&/\.(png|jpg|jpeg)$/i.test(d.name)?w.call(b,d,b.settings.resize,/\.png$/i.test(d.name)?"image/png":"image/jpeg",function(a){a.success?(d.size=a.data.length,m(a.data)):g.chunks?m(n):u(n,m)}):!g.chunks&&g.jpgresize?u(n,m):m(n)}),d.bind("Destroy",function(d){var c,e,g=b.body,h={inputContainer:d.id+"_html5_container",inputFile:d.id+"_html5",browseButton:d.settings.browse_button,dropElm:d.settings.drop_element};
for(c in h)(e=b.getElementById(h[c]))&&a.removeAllEvents(e,d.id);a.removeAllEvents(b.body,d.id);d.settings.container&&(g=b.getElementById(d.settings.container));g.removeChild(b.getElementById(h.inputContainer))}),m({success:!0})):m({success:!1})}})})(window,document,plupload);
(function(c,b,a,k){function n(a){return b.getElementById(a)}a.runtimes.Html4=a.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:a.ua.gecko&&c.FormData||a.ua.webkit}},init:function(k,w){k.bind("Init",function(d){function m(){var c,f,h,r;l=a.guid();w.push(l);c=b.createElement("form");c.setAttribute("id","form_"+l);c.setAttribute("method","post");c.setAttribute("enctype","multipart/form-data");c.setAttribute("encoding","multipart/form-data");c.setAttribute("target",d.id+"_iframe");
c.style.position="absolute";f=b.createElement("input");f.setAttribute("id","input_"+l);f.setAttribute("type","file");f.setAttribute("accept",e);f.setAttribute("size",1);r=n(d.settings.browse_button);d.features.triggerDialog&&r&&a.addEvent(n(d.settings.browse_button),"click",function(a){f.disabled||f.click();a.preventDefault()},d.id);a.extend(f.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"});a.extend(c.style,{overflow:"hidden"});if(h=d.settings.shim_bgcolor)c.style.background=
h;g&&a.extend(f.style,{filter:"alpha(opacity=0)"});a.addEvent(f,"change",function(b){var e=b.target;b=[];e.value&&(n("form_"+l).style.top="-1048575px",e=e.value.replace(/\\/g,"/"),e=e.substring(e.length,e.lastIndexOf("/")+1),b.push(new a.File(l,e)),d.features.triggerDialog?a.removeEvent(r,"click",d.id):a.removeAllEvents(c,d.id),a.removeEvent(f,"change",d.id),m(),b.length&&k.trigger("FilesAdded",b))},d.id);c.appendChild(f);p.appendChild(c);d.refresh()}function r(){var e=b.createElement("div");e.innerHTML=
'<iframe id="'+d.id+'_iframe" name="'+d.id+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';h=e.firstChild;p.appendChild(h);a.addEvent(h,"load",function(b){b=b.target;var e;if(q){try{e=b.contentWindow.document||b.contentDocument||c.frames[b.id].document}catch(f){d.trigger("Error",{code:a.SECURITY_ERROR,message:a.translate("Security error."),file:q});return}if(e=e.body.innerHTML)q.status=a.DONE,q.loaded=1025,q.percent=100,d.trigger("UploadProgress",q),d.trigger("FileUploaded",
q,{response:e})}},d.id)}var p=b.body,h,q,l,w=[],g=/MSIE/.test(navigator.userAgent),e=[],f=d.settings.filters,t,v,z,B;t=0;a:for(;t<f.length;t++)for(v=f[t].extensions.split(/,/),B=0;B<v.length;B++){if("*"===v[B]){e=[];break a}(z=a.mimeTypes[v[B]])&&-1===a.inArray(z,e)&&e.push(z)}e=e.join(",");d.settings.container&&(p=n(d.settings.container),"static"===a.getStyle(p,"position")&&(p.style.position="relative"));d.bind("UploadFile",function(d,c){var e,f;c.status!=a.DONE&&c.status!=a.FAILED&&d.state!=a.STOPPED&&
(e=n("form_"+c.id),f=n("input_"+c.id),f.setAttribute("name",d.settings.file_data_name),e.setAttribute("action",d.settings.url),a.each(a.extend({name:c.target_name||c.name},d.settings.multipart_params),function(d,c){var f=b.createElement("input");a.extend(f,{type:"hidden",name:c,value:d});e.insertBefore(f,e.firstChild)}),q=c,n("form_"+l).style.top="-1048575px",e.submit())});d.bind("FileUploaded",function(a){a.refresh()});d.bind("StateChanged",function(b){b.state==a.STARTED?r():b.state==a.STOPPED&&
c.setTimeout(function(){a.removeEvent(h,"load",b.id);h.parentNode&&h.parentNode.removeChild(h)},0);a.each(b.files,function(b,d){if(b.status===a.DONE||b.status===a.FAILED){var c=n("form_"+b.id);c&&c.parentNode.removeChild(c)}})});d.bind("Refresh",function(d){var c,e,f,g,h,m;if(c=n(d.settings.browse_button))h=a.getPos(c,n(d.settings.container)),m=a.getSize(c),e=n("form_"+l),n("input_"+l),a.extend(e.style,{top:h.y+"px",left:h.x+"px",width:m.w+"px",height:m.h+"px"}),d.features.triggerDialog&&("static"===
a.getStyle(c,"position")&&a.extend(c.style,{position:"relative"}),h=parseInt(c.style.zIndex,10),isNaN(h)&&(h=0),a.extend(c.style,{zIndex:h}),a.extend(e.style,{zIndex:h-1})),f=d.settings.browse_button_hover,g=d.settings.browse_button_active,e=d.features.triggerDialog?c:e,f&&(a.addEvent(e,"mouseover",function(){a.addClass(c,f)},d.id),a.addEvent(e,"mouseout",function(){a.removeClass(c,f)},d.id)),g&&(a.addEvent(e,"mousedown",function(){a.addClass(c,g)},d.id),a.addEvent(b.body,"mouseup",function(){a.removeClass(c,
g)},d.id))});k.bind("FilesRemoved",function(a,b){var d,c;for(d=0;d<b.length;d++)(c=n("form_"+b[d].id))&&c.parentNode.removeChild(c)});k.bind("DisableBrowse",function(a,d){var c=b.getElementById("input_"+l);c&&(c.disabled=d)});k.bind("Destroy",function(d){var c,e,f,g={inputContainer:"form_"+l,inputFile:"input_"+l,browseButton:d.settings.browse_button};for(c in g)(e=n(g[c]))&&a.removeAllEvents(e,d.id);a.removeAllEvents(b.body,d.id);a.each(w,function(a,b){(f=n("form_"+a))&&p.removeChild(f)})});m()});
w({success:!0})}})})(window,document,plupload);
var Photoview=function(){var c,b,a,k,n,u,w=function(a){switch(a.which){case 27:d.close();break;case 39:d.next();break;case 37:d.prev()}},d={show:function(m,r,p){u=p||{};n=0;k=[];c=$("<div/>",{css:{background:"#000",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1001,opacity:.7}}).appendTo("body");b=$("<div/>",{"class":"photoview",css:{position:"fixed",top:0,bottom:0,width:"100%",zIndex:1002,overflow:"auto"},click:function(c){(b.is(c.target)||a.is(c.target))&&d.close()}}).appendTo("body");a=
$('<div class="photoview-in"/>').appendTo(b);d.get(m,-10,function(a){d.showImage(a[0]);return a},!0);$(document).keydown(w)},next:function(){k[n+1]?(d.beforeShowImage(),d.showImage(k[++n])):k[n].isLast||(d.beforeShowImage(),d.get(k[n].date,-10,function(b){b.length?d.showImage(k[++n]):a.find(".photoview-next").hide()}))},prev:function(){k[n-1]?(d.beforeShowImage(),d.showImage(k[--n])):k[n].isFirst||(d.beforeShowImage(),d.get(k[n].date,10,function(b){b.length?d.showImage(k[--n]):a.find(".photoview-prev").hide()}))},
get:function(a,b,d,c){$.ajax("/api/media/player-data",{data:{date:a,storyId:pp.storyId,span:-b},dataType:"json",success:function(a){a.errors?noticeErrors(a.errors):(0<b?(k=[].concat(a.result.media,k),n+=a.result.media.length):(c||a.result.media.shift(),k=k.concat(a.result.media)),d&&d(a.result.media))},error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0445!",!0)}})},beforeShowImage:function(){a.find(".photoview-data").fadeOut(200,
function(){$(this.parentNode).remove()})},showImage:function(b){var c=$('<div class="photoview-item"/>'),k=$("<div/>",{"class":"photoview-data",css:{opacity:0},html:'<h1 class="photoview-title" style="display:inline">'+(b.title||"")+'</h1><br><p class="photoview-img-container"><img src="'+b.thumbLarge.url+'" width="'+b.thumbLarge.width/2+'" height="'+b.thumbLarge.height/2+'"></p><p style="display:inline">'+(b.description||"")+"</p>"}).appendTo(c);b.isFirst||$("<div/>",{"class":"photoview-prev",css:{top:Math.floor(b.thumbLarge.height/
4)},html:'<div class="photoview-prev-in"></div>'}).appendTo(c).click(d.prev);b.isLast||$("<div/>",{"class":"photoview-next",css:{top:Math.floor(b.thumbLarge.height/4)},html:'<div class="photoview-next-in"></div>'}).appendTo(c).click(d.next);k.find(".photoview-img-container").click(function(a){a.target===this&&d.close()});a[0].firstChild?(c.appendTo(a).css({top:Math.ceil(350-b.height/2),visibility:"visible"}),k.delay(200).animate({opacity:1},function(){k.fadeIn()})):(k.css("opacity",1),c.css({top:Math.ceil(350-
b.height/2)}).appendTo(a));b.isLast||a.find("img").click(d.next)},close:function(){c.remove();b.remove();$(document).off("keydown",w);u.close&&u.close()}};return d}();
function inlineEdit(c){function b(){k=!1;c.addClass("editable-not-editing").removeClass("editable-editing")}c=$(c);if(c.length){var a=c.find(".editable"),k=!1;c[0].reset();c.find(".editable-cancel").click(b);a.click(function(){!0!==k&&(k=!0,$(this).find(".editable-input").eq(0).delay(0).queue(function(){this.focus()}),c.removeClass("editable-not-editing").addClass("editable-editing"))});c.submit(function(a){$.ajax(c[0].action,{data:c.serialize(),dataType:"json",type:"post",success:function(a){notice("\u0414\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b!");
var b=a.result;["title"].forEach(function(a){c[0][a].value=b[a];var k=$(c[0][a]).closest(".editable");k.find(".editable-text").text(b[a]);k.find(".editable-placeholder").toggleClass("hidden",!!b[a])})},error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445!",!0)},complete:function(){b();c.find(".editable-submit").prop("disabled",!1)}});c.find(".editable-submit").prop("disabled",!0);a.preventDefault()})}}
function initStoriesIndex(){$(".start-new-story").length&&($("span.start-new-story").click(function(){$("#startNewStory").click()}),[1,2].forEach(function(c){c=new plupload.Uploader({runtimes:"html5,html4",browse_button:"startNewStory"+c,max_file_size:"10mb",url:"/api/media/upload",flash_swf_url:"/js/plupload/plupload.flash.swf",silverlight_xap_url:"/js/plupload/js/plupload.silverlight.xap",filters:[{title:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0438",extensions:"jpg,gif,png"}],multi_selection:!1,
multiple_queues:!0,multipart:!0,multipart_params:{date:(new Date).toISOString().split("T")[0],targetId:0,targetType:2,mediaType:"storyImage"}});var b,a;c.bind("FilesAdded",function(c,n){setTimeout(function(){n[0].status!==plupload.FAILED&&(b=$("<div/>",{html:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f <span>0</span>%.",css:{position:"absolute",top:0,left:0,visibility:"visible"}}),$("#startNewStoryWrap").css({position:"relative",visibility:"hidden"}),b.appendTo("#startNewStoryWrap"),
a=b.find("span"),c.start())},0)});c.bind("UploadProgress",function(b,c){a.html(c.percent)});c.bind("Error",function(a,b){noticeErrors(b.message)});c.bind("UploadComplete",function(){$("#startNewStoryWrap").css("visibility","visible");b.remove()});c.bind("FileUploaded",function(a,b,c){c=$.parseJSON(c.response);c.redirect?window.location=c.redirect:c.errors&&a.trigger("Error",{message:c.errors.join(" "),file:b})});c.init()}))}
function initStory(){$("#userPhotos").on("click",".user-photo-image",function(b){b.preventDefault();this.moved?this.moved=!1:(Photoview.show($(this).closest(".user-photo")[0].id.replace("day-",""),this.src,{close:function(){Story.mode="index"}}),Story.mode="slideshow")});if(pp.canManage){inlineEdit("#storyEditForm");var c=initStoryUploder();Story.uploader=c;StoryDragAndDrop.init({onDragstart:function(){c.pause()},onDragend:function(){c.play()}});$(".user-photo.available").click(function(){var b=$(this);
b.hasClass("i-upload")&&Story.openUpload(b)});$("#userPhotos").on("click",".user-photo-manage",function(b){Story.winOpen($(b.target).closest(".user-photo"))})}}
function initStoryUploder(){var c=plupload.runtimes.Html5.getFeatures,b=!0;plupload.runtimes.Html5.getFeatures=function(){var a=c();a.canOpenDialog=!0;return a};if(plupload.ua.ie){var a=$("<div/>",{id:"uploadUserPhotos",css:{position:"absolute",left:-1E3,zIndex:1E3}}).appendTo("body");$("#userPhotos").on("mouseenter",".i-upload",function(b){function c(b){a.is(b.target)||$(b.target).closest(k).length||($(document).off("mouseout",c),a.css("left","-1000px"),Story.uploader.refresh(),Story.clearActive())}
$("[target="+Story.uploader.id+"_iframe]").css({zIndex:1E3});var k=$(this);b=k.offset();a.css({height:k.height(),width:k.width(),top:b.top,left:b.left});Story.setActive(k.closest(".user-photo"));Story.uploader.refresh();$(document).mouseout(c)})}var k=new plupload.Uploader({runtimes:"html5,html4",max_file_size:"10mb",url:"/api/media/upload",flash_swf_url:"/js/plupload/plupload.flash.swf",silverlight_xap_url:"/js/plupload/js/plupload.silverlight.xap",filters:[{title:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0438",
extensions:"jpg,gif,png"}],browse_button:"uploadUserPhotos",drop_element:"userPhotos",multiple_queues:!0,multipart:!0,multipart_params:{targetId:pp.storyId,targetType:pp.targetType,mediaType:pp.mediaType}});k.bind("FilesAdded",function(a,b){if(Story.active){var c=Story.active[0].id;setTimeout(function(){$.each(b,function(a,b){b.status!==plupload.FAILED&&(b.procces=$("<div/>",{"class":"user-photo-proggress",html:'<div class="user-photo-proggress-bar"></div>'}),b.proccesPercent=b.procces.children(),
b.storyNodeId=c,Story.winClose(),$("#"+c).append(b.procces).find(".user-photo-restore").remove())});a.settings.multipart_params.date=c.replace("day-","");a.start()},0)}});k.bind("UploadProgress",function(a,b){b.proccesPercent.css("width",b.percent+"%")});k.bind("Error",function(a,b){notice(b.message,!0)});k.bind("UploadComplete",function(a,b){$.each(b,function(b,c){c.status===plupload.FAILED&&(a.removeFile(c),c.procces.remove())})});k.bind("FileUploaded",function(a,b,c){a.removeFile(b);b.procces.remove();
c&&(c=JSON.parse(c.response),console.log(c.result),c.result?($("#"+b.storyNodeId+" .user-photo-content").remove(),a=$("<div/>",{"data-id":c.result.id,"class":"user-photo-content",html:'<a><img class="user-photo-image" src="'+c.result.thumbLarge.url+'" width="'+c.result.thumbLarge.width/2+'" height="'+c.result.thumbLarge.height/2+'"></a><div class="user-photo-manage">\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c</div>'}),$("#"+b.storyNodeId).removeClass("empty").removeClass("i-upload").append(a),
StoryDragAndDrop.addContent(a)):c.errors&&a.trigger("Error",{message:c.errors.join(" "),file:b}))});k.init();if("html5"===k.runtime&&k.features.dragdrop){var n,u=!1,w=function(){u&&(u=!1,$("#userPhotos .user-photo-filebodyover").remove())};window.addEventListener("dragover",function(a){if(b&&"slideshow"!==Story.mode){var c;clearTimeout(n);n=setTimeout(w,500);u||(u=!0,$("#userPhotos .available").each(function(a,b){var d=$("<div/>",{"class":"user-photo-filebodyover",html:'<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M 5 5 L 195 5 L 195 195 L 5 195 Z"/><text><tspan x="50%" y="30%">\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435</tspan><tspan x="50%" y="45%">\u0444\u0430\u0439\u043b \u0441\u044e\u0434\u0430,</tspan><tspan x="50%" y="60%">\u0447\u0442\u043e \u0431\u044b \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c</tspan><tspan x="50%" y="75%">\u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e</tspan></text></svg>'}).appendTo(b);
d.on("dragover",function(){clearTimeout(c);Story.setActive($(b))});d.on("dragleave",function(a){c=setTimeout(function(){Story.clearActive()},50)})}))}},!1);k.bind("FilesAdded",w)}k.pause=function(){b=!1};k.play=function(){b=!0};return k}
StoryDragAndDrop={classNames:{isDragging:"user-photo_dragging",onDragenter:"user-photo-dragimageover"},selectors:{container:".user-photo",availableDrop:".user-photo.available",availableContent:".user-photo-content"},isDragging:!1,init:function(c){var b=$(this.selectors.availableDrop),a=$(this.selectors.availableContent);this.options=$.extend({onDragstart:$.noop,onDragend:$.noop},c);this.addEvents(b);this.addContent(a)},addContent:function(c){c.prop("draggable",!0);c.on("dragstart",$.proxy(this.onDragstart,
this));c.on("dragend",$.proxy(this.onDragend,this))},addEvents:function(c){c.on("dragover",$.proxy(this.onDragover,this));c.on("dragenter",$.proxy(this.onDragenter,this));c.on("dragleave",$.proxy(this.onDragleave,this));c.on("drop",$.proxy(this.onDrop,this))},removeEvents:function(c){c.off("dragover",this.onDragover);c.off("dragenter",this.onDragenter);c.off("dragleave",this.onDragleave);c.off("drop",this.onDrop)},onDragstart:function(c){this.startedContainer=c=$(c.target).closest(this.selectors.container);
this.isDragging=!0;c.addClass(this.classNames.contentIsDragging);this.removeEvents(c);this.options.onDragstart();window.attachEvent&&(window.event.dataTransfer.effectAllowed="move",window.event.dataTransfer.dropEffect="move")},onDragenter:function(c){this.isDragging&&$(c.delegateTarget).addClass(this.classNames.onDragenter)},onDragover:function(c){window.attachEvent&&(window.event.returnValue=!1)},onDragleave:function(c){this.isDragging&&$(c.delegateTarget).removeClass(this.classNames.onDragenter)},
onDragend:function(c){this.isDragging&&($(c.target).closest(this.selectors.container),this.startedContainer=!1,this.options.onDragend())},onDrop:function(c){if(this.isDragging){c=$(c.delegateTarget);var b=this.startedContainer,a=b[0].id.replace("day-",""),k=c[0].id.replace("day-",""),n=b.find(this.selectors.availableContent),u=c.find(this.selectors.availableContent);c.removeClass(this.classNames.onDragenter).removeClass("empty").removeClass("i-upload");n.appendTo(c).find("a").each(function(b,c){c.href=
c.href.replace(a,k)});this.addEvents(b);u.length?u.appendTo(b).find("a").each(function(b,c){c.href=c.href.replace(k,a)}):b.addClass("empty").addClass("i-upload");this.isDragging=!1;$.ajax("/api/media/swap-days",{data:{storyId:pp.storyId,dateA:a,dateB:k},type:"post",error:function(){noticeErrors("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u043c\u0435\u0449\u0435\u043d\u0438\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f!")}})}}};
Story={mode:"index",active:null,setActive:function(c){Story.active!==c&&(Story.clearActive(),Story.active=c,c.addClass("active"))},clearActive:function(){Story.active&&Story.active.removeClass("active")},openUpload:function(c){"string"===typeof c&&(c=$("#day-"+c));Story.setActive(c);"html5"===Story.uploader.runtime&&$("#"+Story.uploader.id+"_html5").click()},updateStatus:function(c){$.ajax("/api/story/write",{data:{id:c,status:$("#storyStatusSelector").val()},type:"post",success:function(b){b.errors?
noticeErrors(b.errors):notice("\u0421\u0442\u0430\u0442\u0443\u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0451\u043d")},error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u0441\u0442\u0430\u0442\u0443\u0441\u0430!",!0)}})},updateNotify:function(c){$.ajax("/api/story/write",{data:{id:c,notifyPeriod:$("#storyNotifySelector").val()},type:"post",success:function(b){b.errors?noticeErrors(b.errors):notice("\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430")},
error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u041d\u0430\u0441\u0442\u0440\u043e\u0435\u043a!",!0)}})},winActive:null,winOpen:function(c){$(document).mousedown(Story.winCloseMousedown);var b=c.find(".user-photo-content"),a=c.data("id"),k=b.find(".user-photo-image").parent().clone().find("img").removeClass("user-photo-image");k.css("position","static");var n=$("<div/>",{"class":"user-photo-manage-win",html:'<div class="manage-win"><div class="manage-win-image">'+
k.parent().html()+'</div><div class="manage-win-title">\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435</div><div class="manage-win-control"><a class="ctrl-replace i-upload">\u0417\u0430\u043c\u0435\u043d\u0438\u0442\u044c</a> \u0438\u043b\u0438 <a class="ctrl-remove">\u0443\u0434\u0430\u043b\u0438\u0442\u044c</a>.</div><form class="manage-win-texts"></div></div>'}).appendTo(c);n.find(".ctrl-replace").click(function(){Story.openUpload(c)});$.ajax("/api/media/get",
{data:{id:a},success:function(b){var c=n.find(".manage-win-texts"),d,k;c.html('<input name="t" type="text" class="manage-win-title"><br><textarea name="d" class="manage-win-desc"></textarea><p><input type="submit" class="manage-win-submit" value="\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"> <input type="reset" class="manage-win-reset" onclick="Story.winClose()" value="\u0437\u0430\u043a\u0440\u044b\u0442\u044c"></p>');d=c[0].t;k=c[0].d;d.value=b.result.title;k.value=b.result.description;
c.submit(function(c){c.preventDefault();Story.winClose();d.value===b.result.title&&k.value===b.result.description||$.ajax("/api/media/write",{data:{id:a,title:d.value,description:k.value},type:"post",error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0442\u0435\u043a\u0441\u0442\u0430 \u0434\u043b\u044f \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438!",!0)}})})}});n.find(".ctrl-remove").on("click",
function(){function c(){k.html('<a class="ctrl-restore" onclick="Story.recoverMedia(\''+a+'\')">\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c</a> \u0438\u043b\u0438 <a class="ctrl-replace i-upload" onclick="Story.openUpload(\''+a+"')\">\u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c</a>.")}Story.winClose();var k=$("<div/>",{"class":"user-photo-restore"}).appendTo(b);Story.removeMedia(a,c,c)});c.addClass("win-open");Story.winActive=n},winClose:function(){Story.winActive&&
(Story.winActive.closest(".user-photo").removeClass("win-open"),Story.winActive.remove(),Story.winActive=null,$(document).off("mousedown",Story.winCloseMousedown))},winCloseMousedown:function(c){c.target&&(c=$(c.target).closest(".user-photo"),c.length&&c[0]===Story.winActive.closest(".user-photo")[0]||Story.winClose())},deleteRecover:function(c,b,a){var k;pp.storyDeleted?(k=1,a="\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u044d\u0442\u0443 \u0438\u0441\u0442\u043e\u0440\u0438\u044e?"):
(k=0,a="\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u0443 \u0438\u0441\u0442\u043e\u0440\u0438\u044e?");if(!confirm(a))return!1;$.ajax("/api/story/delete-recover",{data:{id:c,doRecover:k||void 0},type:"post",success:function(a){k?(pp.storyDeleted=0,$("#statusSelectorHoder").removeClass("hidden"),$("#delete-recover").text("\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e"),
notice("\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430")):(pp.storyDeleted=1,$("#delete-recover").text("\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044e"),$("#statusSelectorHoder").addClass("hidden"),notice("\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043f\u0440\u0438\u0433\u043e\u0442\u043e\u0432\u043b\u0435\u043d\u0430 \u043a \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044e"));
b&&b()},error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438.",!0)}})},removeMedia:function(c,b,a){$.ajax("/api/media/delete-recover",{data:{idString:c},type:"post",success:function(a){b&&b()},error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f!",
!0);a&&a()}})},recoverMedia:function(c){$.ajax("/api/media/delete-recover",{data:{idString:c,doRecover:1},type:"post",success:function(b){$("[data-id="+c+"] .user-photo-restore").remove()},error:function(){notice("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445!",!0)}})}};
(function(c){c.tooltipsy=function(b,a){this.options=a;this.$el=c(b);this.title=this.$el.attr("title")||"";this.$el.attr("title","");this.random=parseInt(1E4*Math.random());this.shown=this.ready=!1;this.height=this.width=0;this.delaytimer=null;this.$el.data("tooltipsy",this);this.init()};c.tooltipsy.prototype.init=function(){var b=this;b.settings=c.extend({},b.defaults,b.options);b.settings.delay=parseInt(b.settings.delay);"function"===typeof b.settings.content&&b.readify();b.settings.showEvent===
b.settings.hideEvent&&"click"===b.settings.showEvent?b.$el.toggle(function(a){"click"===b.settings.showEvent&&"A"==b.$el[0].tagName&&a.preventDefault();0<b.settings.delay?b.delaytimer=window.setTimeout(function(){b.show(a)},b.settings.delay):b.show(a)},function(a){"click"===b.settings.showEvent&&"A"==b.$el[0].tagName&&a.preventDefault();window.clearTimeout(b.delaytimer);b.delaytimer=null;b.hide(a)}):b.$el.bind(b.settings.showEvent,function(a){"click"===b.settings.showEvent&&"A"==b.$el[0].tagName&&
a.preventDefault();0<b.settings.delay?b.delaytimer=window.setTimeout(function(){b.show(a)},b.settings.delay):b.show(a)}).bind(b.settings.hideEvent,function(a){"click"===b.settings.showEvent&&"A"==b.$el[0].tagName&&a.preventDefault();window.clearTimeout(b.delaytimer);b.delaytimer=null;b.hide(a)})};c.tooltipsy.prototype.show=function(b){var a=this;!1===a.ready&&a.readify();!1===a.shown&&(0<function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(a.settings.css)&&a.$tip.css(a.settings.css),
a.width=a.$tipsy.outerWidth(),a.height=a.$tipsy.outerHeight());if("cursor"===a.settings.alignTo&&b){var k=[b.pageX+a.settings.offset[0],b.pageY+a.settings.offset[1]];c(window).width()}else k=[function(b){return 0>a.settings.offset[0]?b.left-Math.abs(a.settings.offset[0])-a.width:0===a.settings.offset[0]?b.left-(a.width-a.$el.outerWidth())/2:b.left+a.$el.outerWidth()+a.settings.offset[0]}(a.offset(a.$el[0])),function(b){return 0>a.settings.offset[1]?b.top-Math.abs(a.settings.offset[1])-a.height:0===
a.settings.offset[1]?b.top-(a.height-a.$el.outerHeight())/2:b.top+a.$el.outerHeight()+a.settings.offset[1]}(a.offset(a.$el[0]))];a.$tipsy.css({top:k[1]+"px",left:k[0]+"px"});a.settings.show(b,a.$tipsy.stop(!0,!0))};c.tooltipsy.prototype.hide=function(b){var a=this;!1!==a.ready&&(b&&b.relatedTarget===a.$tip[0]?a.$tip.bind("mouseleave",function(b){b.relatedTarget!==a.$el[0]&&a.settings.hide(b,a.$tipsy.stop(!0,!0))}):a.settings.hide(b,a.$tipsy.stop(!0,!0)))};c.tooltipsy.prototype.readify=function(){this.ready=
!0;this.$tipsy=c('<div id="tooltipsy'+this.random+'" style="position:absolute;z-index:2147483647;display:none">').appendTo("body");this.$tip=c('<div class="'+this.settings.className+'">').appendTo(this.$tipsy);this.$tip.data("rootel",this.$el);var b=this.$el,a=this.$tip;this.$tip.html(""!=this.settings.content?"string"==typeof this.settings.content?this.settings.content:this.settings.content(b,a):this.title)};c.tooltipsy.prototype.offset=function(b){var a=ot=0;if(b.offsetParent){do"BODY"!=b.tagName&&
(a+=b.offsetLeft-b.scrollLeft,ot+=b.offsetTop-b.scrollTop);while(b=b.offsetParent)}return{left:a,top:ot}};c.tooltipsy.prototype.destroy=function(){this.$tipsy.remove();c.removeData(this.$el,"tooltipsy")};c.tooltipsy.prototype.defaults={alignTo:"element",offset:[0,-1],content:"",show:function(b,a){a.fadeIn(100)},hide:function(b,a){a.fadeOut(100)},css:{},className:"tooltipsy",delay:200,showEvent:"mouseenter",hideEvent:"mouseleave"};c.fn.tooltipsy=function(b){return this.each(function(){new c.tooltipsy(this,
b)})}})(jQuery);
